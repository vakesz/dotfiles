#!/bin/bash
# A script to clean up git branches that have been merged

# Text colors
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

echo -e "${YELLOW}Fetching latest changes from remote...${NC}"
git fetch -p

echo -e "${YELLOW}Checking for merged branches...${NC}"
MERGED_BRANCHES=$(git branch --merged | grep -v "\*" | grep -v "master" | grep -v "main" | grep -v "develop")

if [ -z "$MERGED_BRANCHES" ]; then
    echo -e "${GREEN}No merged branches to clean up!${NC}"
    exit 0
fi

echo -e "${YELLOW}The following local branches will be deleted:${NC}"
echo "$MERGED_BRANCHES"
echo ""

read -p "Continue? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo -e "${YELLOW}Deleting branches...${NC}"
    git branch --merged | grep -v "\*" | grep -v "master" | grep -v "main" | grep -v "develop" | xargs -r git branch -d
    echo -e "${GREEN}Done!${NC}"
else
    echo -e "${RED}Operation cancelled.${NC}"
fi